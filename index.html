<!DOCTYPE = html>
<html>


<script>

// let lat;
// let long;


// const getLocation = () => {
// return(navigator.geolocation.getCurrentPosition(showPosition));

// } 

var UserCoords = { lat: '', long: '' };
function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);

    } else {
        alert("Geolocation is not supported by this browser.");
    }
}

function processInfo(data,latLong){
      console.log(data);
      document.getElementById("locations").innerHTML = "";
      let destinationInfo;

  
      let list = document.getElementById("locations");
  
      data.forEach((item) => {
        
        let ul = document.createElement("ul");
        ul.innerText = item.name;
        list.appendChild(ul);
      }
      );

      let listElements = Array.from(document.querySelectorAll('ul ul'));
      for(let i = 0; i < listElements.length; i++){
        try {
          let headers = new Headers();
          headers.append("origin", null);
          console.log(data[i].geometry.location.lat);
          console.log(data[i].geometry.location.lng);
          fetch(`https://stormy-earth-41391.herokuapp.com/https://maps.googleapis.com/maps/api/distancematrix/json?destinations=${data[i].geometry.location.lat}, ${data[i].geometry.location.lng}&origins=${latLong.lat},${latLong.long}&units=imperial&key=AIzaSyCDrxi1blX3JmChSsup4Z8bSd62On_FcFE`,{
              method: 'GET',
              headers: headers
          })
      .then(response => response.json())
      .then(data => {destinationInfo = data;         
        console.log(destinationInfo);
        })
        } catch (e) {
          console.log(e);
        }; 
      


        let openStatus = document.createElement("li");
        let address = document.createElement("li");
        let priceLevel = document.createElement("li");






      }
  
    

}

function showPosition(position) {
    UserCoords.lat = position.coords.latitude;
    UserCoords.long = position.coords.longitude;
    console.log(UserCoords);//Works
}

function getUserCoords(radius) {

    var promise1 = new Promise(function(resolve, reject) {
       navigator.geolocation.getCurrentPosition(function(pos){
          lat = pos.coords.latitude
          long = pos.coords.longitude
          resolve({lat,long});
        }) 
    })

    promise1.then(function(value) {
      let headers = new Headers();
      headers.append('Access-Control-Allow-Origin', "<Origin>");
      headers.append('mode', "no-cors");

      try {
          fetch(`https://stormy-earth-41391.herokuapp.com/https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=${value.lat},${value.long}&radius=${radius}&types=movie_theater&name=movie&key=AIzaSyCDrxi1blX3JmChSsup4Z8bSd62On_FcFE`,{
              method: 'GET',
              headers: headers
          })
      .then(response => response.json())
      .then(data => processInfo(data.results, {lat,long}))
        } catch (e) {
          console.log(e);
        };

    });
    

    // getLocation();
    // console.log(UserCoords);//Returns lat and lng empty
    // // OtherFunction(UserCoords.lat, UserCoords.lng);
}


// function setLocation(position){
//   lat = position.coords.latitude;
//   long = position.coords.longitude;
// }

// function showPosition(position){
//   setLocation(position);
// console.log(`Lat ${position.coords.latitude} Long: ${position.coords.longitude}`);
// document.getElementById("wasd").innerHTML = "Lat " + position.coords.latitude+ " Long:" +position.coords.longitude;

// }



</script>
<!-- 
<script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCDrxi1blX3JmChSsup4Z8bSd62On_FcFE&libraries=places&callback=initMap">
let map;
let service;
let infowindow;

function initMap() {
  const sydney = new google.maps.LatLng(-33.867, 151.195);

  infowindow = new google.maps.InfoWindow();
  map = new google.maps.Map(document.getElementById("map"), {
    center: sydney,
    zoom: 15,
  });

  const request = {
    query: "Museum of Contemporary Art Australia",
    fields: ["name", "geometry"],
  };

  service = new google.maps.places.PlacesService(map);
  service.findPlaceFromQuery(request, (results, status) => {
    if (status === google.maps.places.PlacesServiceStatus.OK && results) {
      for (let i = 0; i < results.length; i++) {
        createMarker(results[i]);
      }

      map.setCenter(results[0].geometry.location);
    }
  });
}

function createMarker(place) {
  if (!place.geometry || !place.geometry.location) return;

  const marker = new google.maps.Marker({
    map,
    position: place.geometry.location,
  });

  google.maps.event.addListener(marker, "click", () => {
    infowindow.setContent(place.name || "");
    infowindow.open(map);
  });
}

window.initMap = initMap;

</script> -->


<body>
  



  
<button id= "start" onclick= "getUserCoords(document.getElementById('radius').value)">Start the service. You will need to enable location services.</button>

<label for="radius">Radius for search(100-50000):</label>

<input id = "radius" max= 50000 type="number" min="100"> 

<ul id = "locations"></ul>



<p id= "wasd"></p>
<div id="googleMap" style="width:100%;height:400px"></div>

</body>
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyBghUa-5tF1PIMHwPHyTUuXj-5brkUypgA",
    authDomain: "filmfinder-3a092.firebaseapp.com",
    databaseURL: "https://filmfinder-3a092-default-rtdb.firebaseio.com/",
    projectId: "filmfinder-3a092",
    storageBucket: "filmfinder-3a092.appspot.com",
    messagingSenderId: "127139994519",
    appId: "1:127139994519:web:3eb049049ede5fd74682d2",
    measurementId: "G-EWJEXEX2M1"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
</script>

</html>